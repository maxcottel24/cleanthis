{% extends 'base.html.twig' %}

{% block title %}
	{{ "Mes Commandes" | trans }}
{% endblock %}

{% block body %}
	<style>
		.btn-aligned {
			position: relative;
			top: -38px;
		}
	</style>

	<div class="container mt-5">
		<h2>{{ "Vos Commandes" | trans }}</h2>
		<ul class="nav nav-tabs" id="myTab" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">{{ "Rendez-vous" | trans }}</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="operation-tab" data-bs-toggle="tab" data-bs-target="#operation" type="button" role="tab" aria-controls="operation" aria-selected="false">{{ "Opération" | trans }}</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="payment-tab" data-bs-toggle="tab" data-bs-target="#payment" type="button" role="tab" aria-controls="payment" aria-selected="false">{{ "Paiement" | trans }}</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab" aria-controls="completed" aria-selected="false">{{ "Terminé" | trans }}</button>
			</li>
		</ul>

		<div
			class="tab-content" id="myTabContent">
			<!-- Onglet Rendez-vous -->
			<div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
				<h1 class="my-5">{{ "Vos rendez-vous" |trans }}</h1>
				<div class="row">
					<div class="row align-items-md-stretch">
						{% for meeting in meetings %}
							{% if meeting.status != 5 %}
								<div class="col-md-6 mb-3">
									<div class="h-100 p-5 text-white bg-dark rounded-3">
										<span class=" {{meeting.Status|meeting_status_badge}}">{{ meeting.Status|meeting_status}}</span>
										<h2>{{ meeting.reservedAt|date('d/m/Y') }}
											à
											{{ meeting.reservedAt|date('H:i') }}
										</h2>
										<br>
										<p>{{ "Pour une surface de : " |trans }}<strong>
												{{ meeting.floorSpace }}{{ " m² " |trans }}</strong>
											<br>{{ " À l'adresse : " |trans }}<strong>
												{{ meeting.address }}
											</strong>
										</p>
										<br>
										{% if meeting.status == 1 or meeting.status == 4 %}
											<a class="btn btn-outline-light" type="button" href="{{path('app_meeting_edit', {'id': meeting.id})}}">{{ "Modifier" |trans }}</a>
										{% endif %}
										{% if meeting.status == 1 or meeting.status == 2 %}
											<div class="d-flex justify-content-end ">
												<form method="post" action="{{ path('app_meeting_delete', {'id': meeting.id}) }}" onsubmit="return confirm('{{ " êtes-vous sûr annuler votre demande de rdv ? (un opérateur va vous contacter) pour une réponse urgente : 01 02 03 04 " |trans }}');">
													<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ meeting.id) }}">
													<button class="btn btn-outline-danger btn-aligned" type="submit">{{ "Annuler" |trans }}</button>
												</form>
												{% if meeting.status == 4 or meeting.status == 2  %}
													<form method="post" action="{{ path('app_meeting_validate', {'id': meeting.id}) }}" onsubmit="return confirm('{{ " etes-vous sur de vouloir valider ce rendez-vous ? " |trans }}');">
														<button class="btn btn-outline-success btn-aligned " type="submit">{{ "Valider" |trans }}</button>
													</form>
												{% endif %}
											</div>
										{% endif %}
										{% if meeting.status == 4   %}
											<div class="d-flex justify-content-end ">
												<form method="post" action="{{ path('app_meeting_validate', {'id': meeting.id}) }}" onsubmit="return confirm('{{ " etes-vous sur de vouloir valider ce rendez-vous ? " |trans }}');">
													<button class="btn btn-outline-success btn-aligned " type="submit">{{ "Valider" |trans }}</button>
												</form>
											</div>
										{% endif %}
									</div>
								</div>
							{% endif %}
						{% else %}
							<p>{{ "Aucun rendez-vous pour le moment." | trans }}</p>
						{% endfor %}
					</div>
				</div>
			</div>

			<!-- Onglet Opération -->
			<div class="tab-pane fade" id="operation" role="tabpanel" aria-labelledby="operation-tab">
				<h1 class="my-5">{{ "Vos Opérations" |trans }}</h1>
				<div class="row">
					<div class="row align-items-md-stretch">
						{% for operation in operations %}
							{% if operation.status != 3 %}
								<div class="col-md-6 mb-3">
									<div class="h-100 p-5 text-white bg-dark rounded-3">
										<span class=" {{operation.status|operation_statuss_badge}}">{{ operation.status|operation_statuss}}</span>
										<h2>{{ operation.intervention|date('d/m/Y H:i') }}</h2>
										<p>{{ "Surface : " |trans }}<strong>{{ operation.floorSpace }}
												m²</strong>
										</p>
										<p>{{ "Description : " |trans }}{{ operation.description }}</p>
										<p>{{ "Prix : " |trans }}{{ operation.price }}€</p>
										{% if operation.status == 2 %}
											<div class="d-flex justify-content-end ">
												<form method="post" action="{{ path('app_operation_customer_validate', {'id': operation.id}) }}" onsubmit="return confirm('{{ " etes-vous sur de vouloir valider cette opération ? " |trans }}');">
													<button class="btn btn-outline-success btn-aligned " type="submit">{{ "Valider" |trans }}</button>
												</form>
											</div>
										{% endif %}
									</div>
								</div>

							{% endif %}
						{% endfor %}
					</div>
				</div>

			</div>

			<!-- Onglet Paiement -->
			<div class="tab-pane fade" id="payment" role="tabpanel" aria-labelledby="payment-tab">
				<h1 class="my-5">{{ "Vos facture en attente de paiement" |trans }}</h1>
				<div class="row">
					<div class="row align-items-md-stretch">
						{% for belong in belongs %}
							{% if belong.invoice.status != 2 %}
								<div class="col-md-6 mb-3">
									<div class="h-100 p-5 text-white bg-dark rounded-3">
										<span class=" {{belong.invoice.status|belong_invoice_status_badge}}">{{ belong.invoice.status|belong_invoice_status}}</span>
										<h2>{{ belong.operation.intervention|date('d/m/Y H:i') }}</h2>
										<p>{{ "Surface : " |trans }}<strong>{{ belong.operation.floorSpace }}
												m²</strong>
										</p>
										<p>{{ "Description : " |trans }}{{ belong.operation.description }}</p>
										<p>{{ "Prix : " |trans }}{{ belong.invoice.amount }}€</p>
										{% if belong.invoice.status == 1 %}
											<div class="d-flex justify-content ">
												<form method="post" action="{{ path('app_invoice_to_pay', {'id': belong.invoice.id}) }}" onsubmit="return confirm('{{ " Êtes-vous sur de vouloir valider cette action ? " |trans }}');">
													<div
														class="mb-5">
														
														<select name="payment_method" id="" class="form-control">
															<option value="">Sélectionner un moyen de paiement</option>
															<option value="Carte Bancaire">Carte Bancaire (Visa, etc...)</option>
															<option value="Chèques bancaire">Chèques bancaire</option>
															<option value="Virement bancaire">Virement bancaire</option>
														</select>
													</div>
													<button class="btn btn-outline-success btn-aligned" type="submit">{{ "Payer" |trans }}</button>
												</form>
											</div>

										{% endif %}
									</div>
								</div>

							{% endif %}
						{% endfor %}
					</div>
				</div>
			</div>

			<!-- Onglet Terminé -->
			<div
				class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab"><!-- Contenu pour l'onglet Terminé -->
			</div>
		</div>
	</div>
{% endblock %}
